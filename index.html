<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>اپ تماس تصویری PWA</title>
  <link rel="manifest" href="manifest.json" />
  <style>
    body, html { margin:0; padding:10px; height:100%; font-family: Arial, sans-serif; background:#f0f0f0; }
    #meet { width: 100%; height: 80vh; margin-top: 10px; border: 1px solid #ccc; background:#fff; }
    #joinSection { max-width: 400px; margin: auto; text-align: center; }
    input[type="text"] { padding: 8px; width: 80%; font-size: 16px; }
    button { padding: 10px 15px; font-size: 16px; cursor: pointer; margin-top: 10px; }
  </style>
</head>
<body>

<div id="joinSection">
  <h2>وارد نام اتاق تماس شوید</h2>
  <input type="text" id="roomNameInput" placeholder="نام اتاق را وارد کنید" />
  <br />
  <button onclick="joinRoom()">وارد اتاق شو</button>
</div>

<div id="meet"></div>

<script src='https://meet.jit.si/external_api.js'></script>
<script>
  let api = null;

  function joinRoom() {
    const roomName = document.getElementById('roomNameInput').value.trim();
    if (!roomName) {
      alert('لطفا نام اتاق را وارد کنید');
      return;
    }

    // اگر قبلاً تماس بود، حذفش کن
    if (api) {
      api.dispose();
    }

    document.getElementById('joinSection').style.display = 'none';

    const domain = "meet.jit.si";
    const options = {
      roomName: roomName,
      parentNode: document.querySelector('#meet'),
      width: "100%",
      height: "100%",
      lang: "fa"
    };

    api = new JitsiMeetExternalAPI(domain, options);
  }
</script>

<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('sw.js').then(() => {
        console.log('Service Worker ثبت شد');
      });
    });
  }
</script>

</body>
</html>
